<!DOCTYPE html>
<html>
  <head>
    <title>Kenya Catholic Musicians Application</title>
    <link rel="stylesheet" type="text/css" href="./styles/index.css">

    </style>
    <link rel="stylesheet" type="text/css" href="./styles/addScripts.css">
    <link rel="stylesheet" href="libs/fontawesome-4.5.0.min.css">

    <!-- declaring firebase sdk -->
      <!-- declaring firebase sdk -->
        <!-- declaring firebase sdk -->
          <!-- declaring firebase sdk -->
            <!-- declaring firebase sdk -->
              <!-- declaring firebase sdk -->
                <!-- declaring firebase sdk -->
            <!-- The core Firebase JS SDK is always required and must be listed first -->
            <!-- <script src="https://www.gstatic.com/Firebasejs/7.22.0/Firebase-firestore.js"></script> -->
<link rel="stylesheet" type="text/css" href="./libs/jquery.dataTables.min.css">


<script src="./libs/jquery-3.5.1.js"></script>
<script src="./libs/jquery.dataTables.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/1.9.426/pdf.js"></script>
<script src="libs/pdfpreview/pdf.worker.js"></script>

<script src="scripts/modals.js"></script> 
 
<script src="https://www.gstatic.com/firebasejs/7.2.1/firebase-app.js"></script>           
<script defer src="https://www.gstatic.com/firebasejs/7.2.2/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.2.1/firebase-firestore.js"></script>
<script src="https://www.gstatic.com/firebasejs/7.2.1/firebase-storage.js"></script>  
<script src="scripts/app.js"></script>
<script>getStatistics();</script>
  </head>
  <body>
    <div  class="box">

     
  
      <!-- navigation content -->
      <!-- navigation content -->
      <!-- navigation content -->
      <!-- navigation content -->
              <!-- navigation content -->
                <!-- navigation content -->
      <div class="nav">
        <ul>
            <li><a href="index.html"><i class="fa fa-home" aria-hidden="true" style="margin-right: 10px;"></i>HOME</a></li>
            <li><a href="users.html"><i class="fa fa-user" aria-hidden="true" style="margin-right: 10px;"></i>USERS</a></li>
            <li><a href="scripts.html"><i class="fa fa-book" aria-hidden="true"></i>SCRIPTS</a></li>
            <li><a href="learners.html"><i class="fa fa-book" aria-hidden="true"></i>LEARNERS</a></li>
            <li><a href="learners.html"><i class="fa fa-book" aria-hidden="true"></i>FORUMS</a></li>
        </ul>
    </div>
      
<div class="home_content_view">
  <div style="background-color: #070222;text-align: center;padding:20px;" class="header" >
    <h3 style="color:#fff;text-align:center;">Kenya Catholic Musicians Application</h3>
  </div>
  <!-- open modal buttons-->
   <!-- open modal buttons-->
    <!-- open modal buttons-->
     <!-- open modal buttons-->
      <!-- open modal buttons-->
       <!-- open modal buttons-->
        <!-- open modal buttons-->
  <div class="open-modal-buttons" style="margin-left: 20px;">
    <div class="open-model_btn" onclick="openAddCategory();"><p>ADD CATEGORY</p></div>
    <div class="open-model_btn" onclick="openAddDiocese();"><p>ADD DIOCESE</p></div>
    <div class="open-model_btn" onclick="openAddScripts();"><p>ADD SCRIPTS</p></div>

<div>

</div>
  </div>
    <div class="detail-container" style="margin-left: 20px;">
          <div class="content_no_of_users" >
     <div id="no_of_users" style="margin-top:50px;"></div>
        </div>
        <div class="content_no_of_users" >
          <div id="no_of_learners" style="margin-top:50px;"></div>
         </div>
         <div class="content_no_of_users" >
          <div id="no_of_songs" style="margin-top:50px;"></div></div>
        </div>
     
    </div>  





<!-- ////////////////////////////////////// -->
<!-- dialog fo adding pdf files -->
<!-- ////////////////////////////////////// -->
<!-- ////////////////////////////////////// -->
<!-- dialog fo adding pdf files -->
<!-- ////////////////////////////////////// -->
<!-- ////////////////////////////////////// -->
<!-- dialog fo adding pdf files -->
<!-- ////////////////////////////////////// -->
<!-- ////////////////////////////////////// -->
<!-- dialog fo adding pdf files -->
<!-- ////////////////////////////////////// -->
<!-- ////////////////////////////////////// -->
<!-- dialog fo adding pdf files -->
<!-- ////////////////////////////////////// -->
<!-- ////////////////////////////////////// -->
<!-- dialog fo adding pdf files -->
<!-- ////////////////////////////////////// -->
<!-- ////////////////////////////////////// -->
<!-- dialog fo adding pdf files -->
<!-- ////////////////////////////////////// -->
    <div style="position: fixed;display:none;background-color:rgba(10, 10, 10, 0.74);top: 0;height: 100%;width: 100%;" id="addscripts">
     
          <div class="dialog_content" style="align-content:center;overflow:auto">
            <div>
              <div class="closemodal" style="padding: 5px;" onclick="closeM3();"><i class="fa fa-times" aria-hidden="true" style="font-size: 30px;"></i></div>
            <div style="margin-left: 10px;width: 100%;text-align:center"><h3>ADD SCRIPTS</h3></div>
          </div>
            <div class="scripts-form">
            <div class="c1">
              <div class="formcontent">
                <div class="tooltip">
                  <span class="tooltiptext">Choose File</span>
              <button id="upload-dialog">Choose PDF</button> <br>
              </div>
              <input type="file" id="pdf-file" accept="application/pdf" style="display:none" /> <br>
             
              <p>please enter title</p>
                  <input type="text" id="title" placeholder="Song Title i.e NI HERI ZAIDI KUTOA" required/><br>
                  <input type="text" id="composer" placeholder="Song Composer i.e BENARD MUKASA" required/><br>
                  <select id="selectDio" required>
                      <option disabled selected >-- Select Category --</option>
                  </select><br>
                  <button onclick="upLoad();" id="upload">upload</button><br>
                  <progress id="uploader" value="0" max="100">0%</progress><br>
                </div>
                </div>
              <!-- <div id="pdf-loader" style="display:none">Loading Preview ..</div>
              <canvas id="pdf-preview" width="150" style="display:none"></canvas>
                  -->
              <dv class="c2">
                  <div id="pdf-loader" style="display:none">Loading Preview ..</div><br>
              <canvas id="pdf-preview" width="500px" height="500px" style="display:none"></canvas><br>
              
              </div>
              
              
              </div>
              <script>
              // Initialize Firebase

              var db=firebase.firestore();
              //-------------------------------------
              var selector = document.getElementById('selector');
              var uploader = document.getElementById('uploader');
              var upload = document.getElementById('upload');
              var file;
              var task;
              var filename;
              
              // var fileButton = document.getElementById('fileButton');
              // selector.addEventListener('change', function(e){
              // file = e.target.files[0];
              // });  
              function upLoad()
              {
              var storageRef = firebase.storage().ref('songs/'+file.name);
              task = storageRef.put(file);
              task.on('state_changed', function progress(snapshot) {
              var percentage = (snapshot.bytesTransferred/snapshot.totalBytes)*100;
             
              uploader.value = percentage;
              switch (snapshot.state) {
                              case firebase.storage.TaskState.PAUSED:
                                console.log('Upload is paused');
                                break;
                              case firebase.storage.TaskState.RUNNING:
                                console.log('Upload is running');
                                uploader.style.display="block";
                                break;
                        
                            }
              }, function(error) {console.log(error);
                        },
                        function () {
                          task.snapshot.ref.getDownloadURL().then(
                              function(downloadURL) {
                              addDocData(downloadURL)
                             // You get your url from here
                              console.log('File available at', downloadURL);
                            
                            // print the image url 
                             console.log(downloadURL);
                            
                          });
                      
              });
              }
              function addDocData(url)
              {
                  var select = document.getElementById('selectDio').value;
                  var approved="yes";
                  var uploader="admin";
                  var downloads="0";
                  var viewed="0";
                  var title=document.getElementById('title').value;
                  var composer=document.getElementById('composer').value;
              
              db.collection("files").doc(select).collection("songs").doc().set({
                  title:title,
                  composer:composer,
                  uploader:uploader,
                  url:url,
                  type: select,
                  approved:approved  
              })
              }
              
              //Appending dioceses to the option tag in the select 
              function appendDiocese(name)
              {
                 return "<option>"+
                  name+
                 "</option>"
              }
              
              
               //Get dioceses to the select tag 
              function getDiocese()
              {
                  var dioref = db.collection("files");
                  dioref.get().then((querySnapshot) => {
                      querySnapshot.forEach((doc) => {
                  var user=appendDiocese(doc.data().name);
                    document.getElementById("selectDio").innerHTML= document.getElementById("selectDio").innerHTML+user;
                     
                      });
                  });}
              
                  var _PDF_DOC;
              
              // PDF.JS renders PDF in a <canvas> element
              var _CANVAS = document.querySelector('#pdf-preview');
              
              // will hold object url of chosen PDF
              var _OBJECT_URL;
              
              // load the PDF
              function showPDF(pdf_url) {
                  PDFJS.getDocument({ url: pdf_url }).then(function(pdf_doc) {
                      _PDF_DOC = pdf_doc;
              
                      // show the first page of PDF
                      showPage(1);
              
                      // destroy previous object url
                      URL.revokeObjectURL(_OBJECT_URL);
                  }).catch(function(error) {
                      // error reason
                      alert(error.message);
                  });;
              }
              
              // show page of PDF
              function showPage(page_no) {
                  _PDF_DOC.getPage(page_no).then(function(page) {
                      // set the scale of viewport
                      var scale_required = _CANVAS.width / page.getViewport(1).width;
              
                      // get viewport of the page at required scale
                      var viewport = page.getViewport(scale_required);
              
                      // set canvas height
                      _CANVAS.height = viewport.height;
              
                      var renderContext = {
                          canvasContext: _CANVAS.getContext('2d'),
                          viewport: viewport
                      };
                      
                      // render the page contents in the canvas
                      page.render(renderContext).then(function() {
                          document.querySelector("#pdf-preview").style.display = 'inline-block';
                          document.querySelector("#upload-dialog").style.display = 'none';
                          document.querySelector("#pdf-loader").style.display = 'none';
                      });
                  });
              }
              
              /* showing upload file dialog */
              document.querySelector("#upload-dialog").addEventListener('click', function() {
                  document.querySelector("#pdf-file").click();
              });
              
              /* when users selects a file */
              document.querySelector("#pdf-file").addEventListener('change', function() {
                  // user selected PDF
                  file = this.files[0];
              
                  // allowed MIME types
                  var mime_types = [ 'application/pdf' ];
                  
                  // validate whether PDF
                  if(mime_types.indexOf(file.type) == -1) {
                      alert('Error : Incorrect file type');
                      return;
                  }
              
                  // validate file size
                  if(file.size > 10*1024*1024) {
                      alert('Error : Exceeded size 10MB');
                      return;
                  }
              
                  // validation is successful
              
                  // hide upload dialog
                  document.querySelector("#upload-dialog").style.display = 'none';
                  
                  // show the PDF preview loader
                  document.querySelector("#pdf-loader").style.display = 'inline-block';
              
                  // object url of PDF 
                  _OBJECT_URL = URL.createObjectURL(file)
              
                  // send the object url of the pdf to the PDF preview function
                  showPDF(_OBJECT_URL);
              });
              </script>
              
              
              
              
              
              <script>getDiocese();</script>
          </div>

          <!-- add category modal -->
          <!-- add category modal -->
          <!-- add category modal -->
          <!-- add category modal -->
          <!-- add category modal -->
          <!-- add category modal -->
          <!-- add category modal -->
          <!-- add category modal -->
          <!-- add category modal -->
          <!-- add category modal -->
          <!-- add category modal -->

          <div id="add-category" style="position: fixed;display:none;width:100%;height:100%;background-color:rgba(10, 10, 10, 0.74);top: 0;height: 100%;width: 100%;margin: auto;">
            <div class="dialog2_content" style="align-content:center;">
              <div>
                <div class="closemodal" style="padding: 5px;" onclick="closeM1();"><i class="fa fa-times" aria-hidden="true" style="font-size: 30px;"></i></div>
              <div style="margin-left: 10px;width: 100%;text-align:center"><h3>ADD MASS CATEGORY</h3></div>
            </div>
              <input type="text" name="" id="cat_name" placeholder="Enter Category of Song i.e Kiingilio"><br>
            <button onclick="addCategory();">SUBMIT</button>
            </div>
            <script type="text/javascript">
            function addCategory(){
             
              var db=firebase.firestore();
              var dio=document.getElementById('cat_name').value;
              db.collection("files").doc(dio)
              .set({name: dio});
            }
            </script>
          </div>
<!-- add diocese modal -->
<!-- add diocese modal -->
<!-- add diocese modal -->
<!-- add diocese modal -->
<!-- add diocese modal -->
<!-- add diocese modal -->
<!-- add diocese modal -->
<!-- add diocese modal -->
<!-- add diocese modal -->

<div id="add-diocese" style="position: fixed;display:none;width:100%;height:100%;background-color:rgba(8, 0, 0, 0.89);top: 0;height: 100%;width: 100%;margin: auto;">
  <div class="dialog2_content" style="align-content:center">
    <div>
      <div class="closemodal" style="padding: 5px;" onclick="closeM2();"><i class="fa fa-times" aria-hidden="true" style="font-size: 30px;"></i></div>
    <div style="margin-left: 10px;width: 100%;text-align:center"><h3>ADD DIOCESE</h3></div>
  </div>
    <input type="text" name="" id="diocese_name" placeholder="Add valid diocese i.e Eldoret"><br>
  <button onclick="addDiocese();">SUBMIT</button>
  </div>
  <script type="text/javascript">
  function addDiocese(){
   
    var db=firebase.firestore();
    var dio=document.getElementById('diocese_name').value;
    db.collection("dioceses").doc()
    .set({name: dio});
    
  }
  </script>
</div>
        </div>  
  </div>

    </div>
   




  </body>
</html>